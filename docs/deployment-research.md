# Zylith Deployment Research — Starknet Sepolia

> Research date: February 2026
> Purpose: Version compatibility, tooling analysis, and deployment strategy for Zylith on Starknet Sepolia.

---

## Table of Contents

1. [Version Compatibility Matrix](#1-version-compatibility-matrix)
2. [Starknet Sepolia Testnet](#2-starknet-sepolia-testnet)
3. [Alchemy RPC Configuration](#3-alchemy-rpc-configuration)
4. [CASM Hash Mismatch Problem](#4-casm-hash-mismatch-problem)
5. [Deployment Tools: starkli vs sncast](#5-deployment-tools-starkli-vs-sncast)
6. [Account & Funding](#6-account--funding)
7. [Recommended Deployment Strategy](#7-recommended-deployment-strategy)
8. [Current Zylith Deployment Status](#8-current-zylith-deployment-status)

---

## 1. Version Compatibility Matrix

### Latest Tool Versions (Feb 2026)

| Tool | Latest Version | Release Date | Key Constraint |
|------|---------------|--------------|----------------|
| **Garaga** | v1.0.1 | Dec 3, 2025 | Requires Cairo 2.14.0, Scarb 2.14.0 |
| **Scarb** | 2.15.1 | Jan 13, 2025 | Bundles Cairo 2.15.0 |
| **Cairo** | 2.15.0 | Dec 19, 2024 | Latest stable compiler |
| **starkli** | 0.4.2 | Jul 30, 2024 | JSON-RPC v0.8.1 (stale, no updates in 7 months) |
| **snforge** | 0.56.0 | Feb 4, 2025 | Requires Scarb >= 2.12.0 |
| **sncast** | 0.56.0 | Feb 4, 2025 | JSON-RPC v0.10 support |
| **Starknet** | v0.14.1 | Dec 2025 | JSON-RPC v0.10.0 |

### Garaga v1.0.1 Requirements

Garaga's generated verifier projects pin these exact versions:

```
# .tool-versions (generated by garaga gen)
scarb 2.14.0
starknet-foundry 0.53.0
```

```toml
# Scarb.toml (generated)
[dependencies]
garaga = { git = "https://github.com/keep-starknet-strange/garaga.git", tag = "v1.0.1" }
starknet = "2.14.0"

[dev-dependencies]
snforge_std = "0.53.0"
assert_macros = "2.14.0"
```

### Zylith Project Configuration

Zylith uses **two separate Scarb configurations**:

| Component | Scarb | Cairo | starknet plugin | snforge |
|-----------|-------|-------|-----------------|---------|
| **Main project** (`src/`) | 2.15.1 | 2.15.0 | 2.9.1 | 0.55.0 |
| **Garaga verifiers** (`garaga_verifiers/`) | 2.14.0 | 2.14.0 | 2.14.0 | 0.55.0 |

This dual-version setup is correct and expected. Garaga verifiers are independent Scarb projects.

### Starknet Network → JSON-RPC Spec Mapping

| Starknet Version | JSON-RPC Spec | Status |
|-----------------|---------------|--------|
| v0.14.1 (current) | **v0.10.0** | Mainnet + Sepolia |
| v0.14.0 | v0.9.0 | Deprecated TX v0/v1/v2 |
| v0.13.5 | v0.8.0 | starkli 0.4.x target |
| v0.13.3 | v0.7.0 | Legacy |

**Key issue:** starkli 0.4.2 targets RPC v0.8.1 but Starknet is at v0.10.0.

---

## 2. Starknet Sepolia Testnet

### How It Works

- Mirrors Starknet mainnet behavior
- Connected to Ethereum Sepolia L1
- Current version: **Starknet v0.14.1**
- Sequencer operated by StarkWare

### Gas Fees: STRK Only

Since **Starknet v0.14.0** (September 2025):

- **Only TX v3 transactions** are accepted
- **STRK is the sole fee token** — ETH fees are fully rejected
- TX v0, v1, v2 are deprecated and rejected by the sequencer
- Fee model follows EIP-1559 pattern (base fees + tips)
- Resource bounds: `l1_gas`, `l2_gas`, `l1_data_gas`

| Transaction Version | Fee Token | Status on Sepolia |
|--------------------|-----------|-------------------|
| v1 (INVOKE) | ETH | **REJECTED** |
| v2 (DECLARE) | ETH | **REJECTED** |
| v3 (INVOKE/DECLARE/DEPLOY_ACCOUNT) | STRK | **Active** |

### Faucets for Testnet STRK

| Faucet | URL | Notes |
|--------|-----|-------|
| **Starknet Foundation** | https://starknet-faucet.vercel.app/ | Official, rate-limited (24h) |
| **Alchemy** | https://www.alchemy.com/faucets/starknet-sepolia | May require mainnet ETH |
| **Starknet Scaffold** | https://app.starknetscaffold.xyz/ | SepETH + SepSTRK |
| **BlastAPI** | https://blastapi.io/faucets/starknet-sepolia-strk | May be discontinued |

**Funding estimate for Zylith full deploy:**
- Each Garaga verifier declare: ~70 STRK (1.9MB Sierra files)
- Coordinator + Pool declare: ~10-30 STRK each
- Deploy transactions: ~5-10 STRK each
- **Total estimated: ~400-500 STRK** (multiple faucet requests needed)

---

## 3. Alchemy RPC Configuration

### Supported Spec Versions

Alchemy supports: **v0_6, v0_7, v0_8, v0_9**

(v0_10 not yet documented as of Feb 2026)

### URL Format

```
https://starknet-sepolia.g.alchemy.com/starknet/version/rpc/{VERSION}/{API_KEY}
```

### Recommended Configuration

| Tool | RPC Version | URL |
|------|-------------|-----|
| **starkli 0.4.x** | `v0_8` | `https://starknet-sepolia.g.alchemy.com/starknet/version/rpc/v0_8/{KEY}` |
| **sncast 0.54+** | `v0_9` | `https://starknet-sepolia.g.alchemy.com/starknet/version/rpc/v0_9/{KEY}` |
| **snforge fork tests** | `v0_9` | `https://starknet-sepolia.g.alchemy.com/starknet/version/rpc/v0_9/{KEY}` |

### Verified Working

```bash
# starkli 0.4.0 + Alchemy v0_8 → account deploy: OK
# starkli 0.4.0 + Alchemy v0_8 → declare (with --casm-hash): OK
# starkli 0.4.0 + Alchemy v0_8 → estimateFee: OK (with spec 0.8.1 warning)
# starkli 0.4.0 + Alchemy v0_7 → estimateFee: FAILS (l1_data_gas error)
```

---

## 4. CASM Hash Mismatch Problem

### The Error

```
Error: TransactionExecutionError: Mismatch compiled class hash for class with hash 0x019a94...
Actual: 0x7814df..., Expected: 0x73202...
```

### Root Cause

When you declare a contract:

1. **You** compile Sierra → CASM locally (via starkli's built-in compiler)
2. You submit the Sierra class + CASM hash in the declare TX
3. The **sequencer** independently compiles Sierra → CASM
4. If the sequencer's CASM hash differs from yours → **REJECTED**

The mismatch happens because **different compiler versions produce different CASM** from the same Sierra input:

- starkli 0.4.2 has a built-in CASM compiler (v2.11.2)
- Scarb 2.14.0 compiles Sierra with Cairo 2.14.0's compiler
- The sequencer uses its own compiler version
- All three may produce different CASM

### Solutions

**Solution 1: `--casm-hash` flag (what works for us)**

1. Attempt declare without CASM hash → it fails
2. Read the "Expected" hash from the error message
3. Re-declare with `--casm-hash <expected_hash>`

```bash
# First attempt (fails, but reveals expected hash)
starkli declare contract.json --rpc $RPC ...
# Error: ... Expected: 0x73202...

# Second attempt (succeeds)
starkli declare contract.json --casm-hash 0x73202... --rpc $RPC ...
```

**Solution 2: `--casm-file` flag**

Pass the pre-compiled CASM file from `scarb build`:

```bash
starkli declare contract_class.json \
    --casm-file compiled_contract_class.json \
    --rpc $RPC ...
```

> Note: This still fails if the CASM file was compiled with a different compiler than the sequencer.

**Solution 3: Use sncast instead (recommended)**

`sncast` from Starknet Foundry handles CASM compilation differently and supports RPC v0.10:

```bash
sncast --url $RPC declare --contract-name MyContract
sncast --url $RPC deploy --class-hash 0x... --constructor-calldata 0x...
```

---

## 5. Deployment Tools: starkli vs sncast

### starkli (current tool)

| Aspect | Status |
|--------|--------|
| Latest version | 0.4.2 (Jul 2024) |
| JSON-RPC spec | v0.8.1 |
| Maintenance | **Stale — no releases in 7+ months** |
| TX version | v3 only (STRK fees) |
| CASM compilation | Built-in compiler, may mismatch sequencer |
| Workaround needed | `--casm-hash` for each declare |

### sncast (Starknet Foundry, alternative)

| Aspect | Status |
|--------|--------|
| Latest version | 0.56.0 (Feb 2025) |
| JSON-RPC spec | **v0.10.0** (native) |
| Maintenance | Active development |
| TX version | v3 (STRK fees) |
| CASM compilation | Delegates to Scarb's compiler |
| Account management | `sncast account create/deploy` |

### sncast Deployment Flow

```bash
# 1. Configure account
sncast account create --network sepolia --name deployer

# 2. Fund the account via faucet

# 3. Deploy account
sncast account deploy --network sepolia --name deployer

# 4. Declare contract
sncast --account deployer --url $RPC \
    declare --contract-name MyContract

# 5. Deploy contract
sncast --account deployer --url $RPC \
    deploy --class-hash 0x... --constructor-calldata 0x...
```

### Comparison for Zylith

| Feature | starkli 0.4.2 | sncast 0.56.0 |
|---------|--------------|---------------|
| RPC compatibility | v0.8 (needs Alchemy v0_8) | v0.10 (native) |
| CASM hash issue | Requires `--casm-hash` workaround | Handles automatically |
| Multi-project support | Manual per-directory | Via snfoundry.toml |
| Account already created | Yes (deployed on Sepolia) | Would need new account |
| Garaga verifiers (Scarb 2.14.0) | Works with CASM hash | Needs Scarb 2.14.0 in PATH |

---

## 6. Account & Funding

### Current Account

| Field | Value |
|-------|-------|
| Address | `<YOUR_ACCOUNT_ADDRESS>` |
| Type | OpenZeppelin v1.0.0 (Cairo v2.9.4) |
| Status | **Deployed** on Sepolia |
| Class hash | `<ACCOUNT_CLASS_HASH>` |
| STRK balance | Check via block explorer |
| ETH balance | 0 |

### Keystore

- File: `scripts/starknet-account/keystore.json`
- Password: set in `.env.local` as `STARKNET_KEYSTORE_PASSWORD`
- Public key: `<YOUR_PUBLIC_KEY>`

### Funding Strategy

Each Garaga verifier declare requires ~70 STRK due to the large contract size (~1.9MB Sierra).

**Estimated total STRK needed:**

| Operation | Estimated Cost |
|-----------|---------------|
| 3x Garaga verifier declares | ~210 STRK |
| Coordinator declare | ~20 STRK |
| Pool declare | ~30 STRK |
| 6x deploy transactions | ~30 STRK |
| Buffer for retries | ~50 STRK |
| **Total** | **~340 STRK** |

Check your current balance and calculate how many more STRK you need from faucets.

Faucets typically give 50-100 STRK per request with 24h rate limits. May need 3-5 faucet requests over several days, or use multiple faucets simultaneously.

---

## 7. Recommended Deployment Strategy

### Option A: Continue with starkli (quick, workaround-based)

**Pros:** Account already deployed, one verifier already declared.
**Cons:** CASM hash workaround needed, starkli is stale.

```bash
# For each contract:
# 1. Try declare → capture Expected CASM hash from error
# 2. Re-declare with --casm-hash
# 3. Deploy

export STARKNET_KEYSTORE_PASSWORD=<YOUR_PASSWORD>
RPC="https://starknet-sepolia.g.alchemy.com/starknet/version/rpc/v0_8/<KEY>"

# Declare (first attempt to get expected CASM hash)
OUTPUT=$(starkli declare contract.json --rpc $RPC ... 2>&1) || true
EXPECTED=$(echo "$OUTPUT" | grep -o 'Expected: 0x[0-9a-fA-F]*' | cut -d' ' -f2)

# Declare (with correct CASM hash)
starkli declare contract.json --casm-hash $EXPECTED --rpc $RPC ...

# Deploy
starkli deploy $CLASS_HASH $CONSTRUCTOR_ARGS --rpc $RPC ...
```

### Option B: Switch to sncast (cleaner, future-proof)

**Pros:** Native RPC v0.10, active maintenance, no CASM hash workaround.
**Cons:** Need to set up new account or import existing one.

```bash
# Configure snfoundry.toml
[sncast.sepolia]
url = "https://starknet-sepolia.g.alchemy.com/starknet/version/rpc/v0_9/<KEY>"
account = "deployer"

# Import existing account or create new one
sncast account create --network sepolia --name deployer

# Declare (from garaga_verifiers directory with scarb 2.14.0)
cd garaga_verifiers/membership_verifier
sncast --profile sepolia declare --contract-name Groth16VerifierBN254

# Deploy
sncast --profile sepolia deploy --class-hash 0x... --constructor-calldata ...
```

### Recommendation

**Use Option A (starkli) to finish deployment** since:
1. Account is already deployed with starkli
2. One verifier already declared
3. The `--casm-hash` workaround is proven to work
4. Script (`scripts/deploy.sh`) can be updated to auto-discover CASM hashes

**For future deployments**, consider migrating to sncast for better network compatibility.

### Updated deploy.sh Strategy

The deploy script should be updated to handle CASM hash discovery:

```bash
declare_contract() {
    local sierra_file="$1"
    local name="$2"

    # First attempt: let starkli compile CASM
    output=$(starkli declare "$sierra_file" "${RPC_FLAGS[@]}" 2>&1) || true

    # Check if already declared
    if echo "$output" | grep -q "AlreadyDeclared\|already declared"; then
        hash=$(echo "$output" | grep -oE '0x[0-9a-fA-F]{50,}' | head -1)
        echo "$hash"
        return
    fi

    # Check for CASM mismatch → extract expected hash and retry
    if echo "$output" | grep -q "Mismatch compiled class hash"; then
        expected_hash=$(echo "$output" | grep -o 'Expected: 0x[0-9a-fA-F]*' | head -1 | cut -d' ' -f2)
        if [[ -n "$expected_hash" ]]; then
            output=$(starkli declare "$sierra_file" \
                --casm-hash "$expected_hash" \
                "${RPC_FLAGS[@]}" 2>&1)
        fi
    fi

    # Extract class hash from successful declare
    hash=$(echo "$output" | grep -oE '0x[0-9a-fA-F]+' | tail -1)
    echo "$hash"
}
```

---

## 8. Current Zylith Deployment Status

### Deployed/Declared

| Contract | Status | Hash/Address |
|----------|--------|-------------|
| OZ Account | **Deployed** | `<YOUR_ACCOUNT_ADDRESS>` |
| membership_verifier | **Declared** | Class: `<MEMBERSHIP_VERIFIER_CLASS_HASH>` |

### Remaining

| Contract | Status | Blocker |
|----------|--------|---------|
| swap_verifier | Pending | Insufficient STRK |
| mint_verifier | Pending | Insufficient STRK |
| burn_verifier | Pending | Insufficient STRK |
| VerifierCoordinator | Pending | Verifiers must be deployed first |
| ZylithPool | Pending | Coordinator must be deployed first |

### Next Steps

1. **Fund account** with ~270+ more STRK from faucets
2. **Update `scripts/deploy.sh`** with CASM hash auto-discovery
3. **Update `.env.local`** RPC to v0_8 (already done)
4. **Run deploy script** to declare + deploy all remaining contracts
5. **Verify contracts** on Voyager/Starkscan block explorer

---

## References

- [Garaga v1.0.1 Release](https://github.com/keep-starknet-strange/garaga/releases/tag/v1.0.1)
- [Garaga Documentation](https://garaga.gitbook.io/garaga/)
- [Starkli Releases](https://github.com/xJonathanLEI/starkli/releases)
- [Starkli Book](https://book.starkli.rs/)
- [Scarb Releases](https://github.com/software-mansion/scarb/releases)
- [Starknet Foundry Releases](https://github.com/foundry-rs/starknet-foundry/releases)
- [Starknet Version Notes](https://docs.starknet.io/resources/version-notes/)
- [Starknet Compatibility Tables](https://docs.starknet.io/resources/compatibility/)
- [Starknet v0.14.0 TX Deprecation](https://github.com/starknet-io/deprecation-guide)
- [Alchemy Starknet RPC Docs](https://www.alchemy.com/docs/reference/starknet-api-faq)
- [Starknet Foundation Faucet](https://starknet-faucet.vercel.app/)
